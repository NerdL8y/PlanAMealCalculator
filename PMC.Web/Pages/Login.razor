@page "/login"
@using PMC.Data



<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Login</title>
</head>
<body>
    Username: <input id="txtUserName" @bind="@UserName" type="text" /> <br />
    Password: <input id="txtPassword" @bind="@Password" type="password" /><br />
    <input id="btnLogin" @onclick="Authenticate" type="button" value="Login" />


</body>
</html>

@code {

    [Inject]
    private RepoFactory repoFactory { get; set; }

    public string UserName { get; set; }
    public string Password { get; set; }


    static readonly HttpClient client = new HttpClient();

    //using Login as the method name causes it to be the same as the class name and that is not acceptable
    public async void Authenticate()
    {

        //client.BaseAddress = new Uri("https://localhost:44311/");
        var repo = repoFactory.Get<PMC.Data.SessionInfoRepo>();
        var results = repo.Authenticate(UserName, Password);
        repoFactory.SessionId = results.SsID;
        repoFactory.UserID = results.UserID;
        HttpResponseMessage response = await client.GetAsync("https://localhost:44311/plannedmeals");
        response.EnsureSuccessStatusCode();
        string responseBody = await response.Content.ReadAsStringAsync();
        Console.WriteLine(responseBody);
    }


}