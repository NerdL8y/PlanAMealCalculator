// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace PMC.Web.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\Debora\source\repos\PMC\PMC.Web\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\Debora\source\repos\PMC\PMC.Web\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\Debora\source\repos\PMC\PMC.Web\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\Debora\source\repos\PMC\PMC.Web\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\Debora\source\repos\PMC\PMC.Web\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\Debora\source\repos\PMC\PMC.Web\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\Debora\source\repos\PMC\PMC.Web\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\Debora\source\repos\PMC\PMC.Web\_Imports.razor"
using PMC.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\Debora\source\repos\PMC\PMC.Web\_Imports.razor"
using PMC.Web.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\Debora\source\repos\PMC\PMC.Web\Pages\MyMeal.razor"
using PMC.Web.Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\Debora\source\repos\PMC\PMC.Web\Pages\MyMeal.razor"
using PMC.Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\Debora\source\repos\PMC\PMC.Web\Pages\MyMeal.razor"
using PMC.DataModel;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\Debora\source\repos\PMC\PMC.Web\Pages\MyMeal.razor"
using Microsoft.AspNetCore.WebUtilities;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/mymeal")]
    public partial class MyMeal : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 156 "C:\Users\Debora\source\repos\PMC\PMC.Web\Pages\MyMeal.razor"
       

    [Inject]
    private RepoFactory repoFactory { get; set; }
    private int userID;
    private int mealID;
    private int currCompID = 0;
    private int currentNumGuests;
    private int currentNumPreparers;
    private int newNumGuests;
    private int newNumPreparers;
    private int mealComponentCount = 0;
    private int componentCount = 0;

    private Meal mymeal = new Meal();

    private List<Component> components = new List<Component>();
    private List<ComponentType> componentTypes = new List<ComponentType>();
    private List<MealComponent> currentMealComponents = new List<MealComponent>();
    private List<Recipe> recipes = new List<Recipe>();

    public string MealName { get; set; }
    public string MealTypeDesc { get; set; }

    private string currentMealName = "";
    private string newMealName = "";

    private DateTime dateCompiled;
    private DateTime tempTime = new DateTime(01, 01, 01, 13, 00, 00);
    private DateTime mealServeTime;
    private DateTime startMealPrepNLT;
    private DateTime currentMealDate;
    private DateTime newMealDate;

    private bool changesMade = false;


    //PMC1092-31
    protected override async Task OnInitializedAsync()
    {
        userID = repoFactory.UserID;
        SelectedComponentService.ComponentID = 0;

        if (SelectedMealService.MealID != 0)
        {
            var repo = repoFactory.Get<PMC.Data.MealRepo>();
            mymeal = repo.GetMealByMealID(SelectedMealService.MealID);
            currentMealName = mymeal.MealName;
            currentMealDate = new DateTime(mymeal.MealDate.Year, mymeal.MealDate.Month, mymeal.MealDate.Day, mymeal.ServeTime.Hour, mymeal.ServeTime.Minute, 0);
            currentNumGuests = mymeal.MealGuests;
            currentNumPreparers = mymeal.NumPreparers;

            var repoCR = repoFactory.Get<PMC.Data.MealComponentRepo>();
            var currMealComps = repoCR.GetMealComponentsByMealID(mymeal.MealID).ToList();
            currentMealComponents = currMealComps;
            mealComponentCount = currMealComps.Count();
            
            var compRepo = repoFactory.Get<PMC.Data.ComponentRepo>();
            components = compRepo.GetComponentsByUserID(userID).ToList();
            componentCount = components.Count + 2;

            var ctRepo = repoFactory.Get<PMC.Data.ComponentTypeRepo>();
            componentTypes = ctRepo.GetComponentTypes().ToList();

            var repoRecipe = repoFactory.Get<PMC.Data.RecipeRepo>();
            recipes = repoRecipe.GetRecipesByMealID(SelectedMealService.MealID).ToList();

        }

    }

    private void changeMade()
    {
        changesMade = true;
    }

    //PMC1092-18
    private void saveMealChanges()
    {
        var repo = repoFactory.Get<PMC.Data.MealRepo>();
        repo.SetMealName(SelectedMealService.MealID, currentMealName);
        repo.SetMealDate(SelectedMealService.MealID, currentMealDate);
        repo.SetMealNumberOfGuests(SelectedMealService.MealID, currentNumGuests);
        repo.SetMealNumberOfPreparersByMealID(SelectedMealService.MealID, currentNumPreparers);
        changesMade = false;
        StateHasChanged();
        refreshPage();
    }

    protected async void AddComponentToMeal()
    {

        SelectedComponentService.OnChange += StateHasChanged;
        dateCompiled = new DateTime(mymeal.MealDate.Year, mymeal.MealDate.Month, mymeal.MealDate.Day, tempTime.Hour, tempTime.Minute, 0);
        StateHasChanged();
        var repo = repoFactory.Get<PMC.Data.MealComponentRepo>();
        var repoList = repo.InsertMealComponentByMealIDCompID(SelectedMealService.MealID, SelectedComponentService.ComponentID, dateCompiled, userID);
        var mrepo = repoFactory.Get<PMC.Data.MealRepo>();
        mymeal = mrepo.GetMealByMealID(SelectedMealService.MealID);

        currentMealComponents = repo.GetMealComponentsByMealID(SelectedMealService.MealID).ToList();
        mealComponentCount = currentMealComponents.Count();

        RefreshComponentInfo();
        refreshPage();
        StateHasChanged();
    }

    protected async void RefreshComponentInfo()
    {
        var crepo = repoFactory.Get<PMC.Data.MealComponentRepo>();
        SelectedComponentService.ComponentID = 0;
        tempTime = new DateTime(01, 01, 01, 13, 00, 00);
        StateHasChanged();
    }


    private void refreshPage()
    {
        var repo = repoFactory.Get<PMC.Data.MealRepo>();
        mymeal = repo.GetMealByMealID(SelectedMealService.MealID);
        NavManager.NavigateTo(HomeURIService.homeUri + "empty");
        NavManager.NavigateTo(HomeURIService.homeUri + "mymeal");
    }

    protected bool isOpened = false;
    void OpenModal()
    {
        isOpened = true;

    }
    void CloseModal()
    {
        isOpened = false;
    }


#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private HomeURIService HomeURIService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private SelectedComponentService SelectedComponentService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private SelectedMealService SelectedMealService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NavigationManager NavManager { get; set; }
    }
}
#pragma warning restore 1591
