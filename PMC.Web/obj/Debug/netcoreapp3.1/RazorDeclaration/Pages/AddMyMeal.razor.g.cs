// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace PMC.Web.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\Debora\source\repos\PMC\PMC.Web\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\Debora\source\repos\PMC\PMC.Web\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\Debora\source\repos\PMC\PMC.Web\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\Debora\source\repos\PMC\PMC.Web\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\Debora\source\repos\PMC\PMC.Web\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\Debora\source\repos\PMC\PMC.Web\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\Debora\source\repos\PMC\PMC.Web\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\Debora\source\repos\PMC\PMC.Web\_Imports.razor"
using PMC.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\Debora\source\repos\PMC\PMC.Web\_Imports.razor"
using PMC.Web.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\Debora\source\repos\PMC\PMC.Web\Pages\AddMyMeal.razor"
using PMC.Web.Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\Debora\source\repos\PMC\PMC.Web\Pages\AddMyMeal.razor"
using PMC.Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\Debora\source\repos\PMC\PMC.Web\Pages\AddMyMeal.razor"
using PMC.DataModel;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/addmymeal")]
    public partial class AddMyMeal : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 145 "C:\Users\Debora\source\repos\PMC\PMC.Web\Pages\AddMyMeal.razor"
       

    [Inject]
    private RepoFactory repoFactory { get; set; }
    private int userID;

    private Meal meal = new Meal();
    private List<MealComponent> mealComponents = new List<MealComponent>();
    public string MealName { get; set; }
    public DateTime MealDate { get; set; }
    public int MealGuests { get; set; }
    public int _mealType { get; set; }
    public string MealTypeDesc { get; set; }
    public int NumPreparers { get; set; }
    public List<MealType> mealtype = new List<MealType>();
    private MealType currentChoice;
    private bool validMealName = false;
    private string errorMsg = "";
    private List<ComponentType> componentTypes = new List<ComponentType>();
    private List<Component> components = new List<Component>();
    private int componentCount = 0;
    private List<MealComponent> currentMealComponents = new List<MealComponent>();
    private int mealComponentCount = 0;
    private TimeSpan LocalTime = TimeSpan.FromHours(0);
    private DateTime tempTime = new DateTime(01, 01, 01, 13, 00, 00);


    private DateTime dateCompiled;
    //private DateTime servetime;


    protected override async Task OnInitializedAsync()
    {
        userID = repoFactory.UserID;
        SelectedMealService.MealID = 0;
        var mealtypeRepo = repoFactory.Get<PMC.Data.MealTypeRepo>();
        var mtList = mealtypeRepo.GetMealTypes().ToList();
        mealtype = mtList;

        var compRepo = repoFactory.Get<PMC.Data.ComponentRepo>();
        components = compRepo.GetComponentsByUserID(userID).ToList();
        componentCount = components.Count + 5;

        var ctRepo = repoFactory.Get<PMC.Data.ComponentTypeRepo>();
        componentTypes = ctRepo.GetComponentTypes().ToList();

        //Defaults mealdate to today instead of 01/01/01
        MealDate = DateTime.Today;

        //Number of preparers always defaults to 1 as minimum
        NumPreparers = 1;

        //initialize mealname so it is not void when testing mealname.length
        MealName = "";


        if (userID > 0)
        {
            //Design states the number of guests will default to the User's number of family members
            var userRepo = repoFactory.Get<PMC.Data.UserRepo>();
            var currentRepo = userRepo.GetUserByUserID(userID);
            MealGuests = currentRepo.UserNumFamMembers;
        }
    }

    //PMC1092-09 PMC1092-13 PMC1092-32
    public async void AddMeal()
    {
        validMealName = false;
        var repo = repoFactory.Get<PMC.Data.MealRepo>();

        CheckMealName();

        if (validMealName == true)
        {
            var currentMeal = repo.InsertMealByUserID(MealName, MealDate, MealGuests, currentChoice.MealTypeID, NumPreparers, userID);
            meal = currentMeal;
            SelectedMealService.MealID = currentMeal.MealID;
            meal = repo.GetMealByMealID(SelectedMealService.MealID); ;
            MealTypeDesc = meal.MealTypeDesc;
            SelectedMealService.OnChange += StateHasChanged;
        }
        if (validMealName == false)
        {
            errorMsg = "A meal with the name '" + MealName + "' already exists. Please use a different name.";
        }
        StateHasChanged();
    }

    //verifies the meal name does not already exists for the user in the database.
    public async void CheckMealName()
    {
        var repo = repoFactory.Get<PMC.Data.MealRepo>();
        var mealinfo = repo.CheckMealNameByUserID(MealName, userID);
        if (mealinfo.MealNameCount == 0)
        {
            validMealName = true;
        }
        if (mealinfo.MealNameCount != 0)
        {
            validMealName = false;
        }
        StateHasChanged();
    }



    protected async void AddComponentToMeal()
    {

        SelectedComponentService.OnChange += StateHasChanged;
        dateCompiled = new DateTime(meal.MealDate.Year, meal.MealDate.Month, meal.MealDate.Day, tempTime.Hour, tempTime.Minute, 0);
        StateHasChanged();
        var repo = repoFactory.Get<PMC.Data.MealComponentRepo>();
        var repoList = repo.InsertMealComponentByMealIDCompID(SelectedMealService.MealID, SelectedComponentService.ComponentID, dateCompiled, userID);
        var mrepo = repoFactory.Get<PMC.Data.MealRepo>();
        meal = mrepo.GetMealByMealID(SelectedMealService.MealID);

        currentMealComponents = repo.GetMealComponentsByMealID(SelectedMealService.MealID).ToList();
        mealComponentCount = currentMealComponents.Count();

        NavManager.NavigateTo(HomeURIService.HomeUri + "mymeal");
    }

    protected bool isOpened = false;
    void OpenModal()
    {
        isOpened = true;

    }
    void CloseModal()
    {
        isOpened = false;
    }


#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private HomeURIService HomeURIService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NavigationManager NavManager { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private SelectedComponentService SelectedComponentService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private SelectedMealService SelectedMealService { get; set; }
    }
}
#pragma warning restore 1591
